<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Price Match Calculator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 30px auto;
    padding: 10px;
  }
  label, input, button {
    display: block;
    margin-bottom: 10px;
    font-size: 16px;
  }
  input[type="number"], input[type="text"] {
    padding: 6px;
    width: 100%;
    box-sizing: border-box;
  }
  .part {
    border: 1px solid #ccc;
    padding: 10px;
    margin-bottom: 15px;
    position: relative;
  }
  .refund {
    font-weight: bold;
    margin-top: 6px;
  }
  button {
    padding: 10px;
    cursor: pointer;
  }
  .remove-btn {
    position: absolute;
    right: 10px;
    top: 10px;
    background: #f44336;
    color: white;
    border: none;
    padding: 4px 8px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>Price Match Calculator</h1>

<label for="kitPrice">Kit Price:</label>
<input type="number" id="kitPrice" min="0" step="0.01" placeholder="Enter kit price" />

<div id="partsContainer"></div>

<button id="addPartBtn">Add Part</button>
<button id="calculateBtn">Calculate Refunds</button>

<script>
  const partsContainer = document.getElementById('partsContainer');
  const addPartBtn = document.getElementById('addPartBtn');
  const calculateBtn = document.getElementById('calculateBtn');
  const kitPriceInput = document.getElementById('kitPrice');

  function createPart(index) {
    const div = document.createElement('div');
    div.className = 'part';
    div.dataset.index = index;

    div.innerHTML = `
      <label>Part Number:</label>
      <input type="text" class="part-number" placeholder="Enter part number" />
      <label>Part Price:</label>
      <input type="number" class="part-price" min="0" step="0.01" placeholder="Enter part price" />
      <div class="refund">Refund: $0.00</div>
      <button class="remove-btn" title="Remove this part">X</button>
    `;

    div.querySelector('.remove-btn').addEventListener('click', () => {
      div.remove();
    });

    return div;
  }

  addPartBtn.addEventListener('click', () => {
    const newIndex = partsContainer.children.length;
    partsContainer.appendChild(createPart(newIndex));
  });

  calculateBtn.addEventListener('click', () => {
    const kitPrice = parseFloat(kitPriceInput.value);
    if (isNaN(kitPrice) || kitPrice <= 0) {
      alert('Please enter a valid kit price greater than 0.');
      return;
    }

    const parts = [...partsContainer.querySelectorAll('.part')];
    let totalPartsPrice = 0;
    const partsData = [];

    // Read and validate part prices
    for (const partDiv of parts) {
      const partNumber = partDiv.querySelector('.part-number').value.trim();
      const partPriceInput = partDiv.querySelector('.part-price');
      const partPrice = parseFloat(partPriceInput.value);

      if (!partNumber) {
        alert('Please enter a part number for every part.');
        return;
      }

      if (isNaN(partPrice) || partPrice < 0) {
        alert('Please enter a valid part price (0 or more) for every part.');
        return;
      }

      totalPartsPrice += partPrice;
      partsData.push({ partDiv, partPrice });
    }

    // Calculate refunds
    for (const { partDiv, partPrice } of partsData) {
      let refund;
      if (totalPartsPrice <= kitPrice) {
        refund = partPrice;
      } else {
        refund = (partPrice / totalPartsPrice) * kitPrice;
      }
      refund = refund.toFixed(2);
      partDiv.querySelector('.refund').textContent = `Refund: $${refund}`;
    }
  });

  // Start with one part input
  addPartBtn.click();
</script>

</body>
</html>
